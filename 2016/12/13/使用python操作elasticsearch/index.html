<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="python,elasticsearch," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="和你们这些少爷不同，我们光是活着就竭尽全力了。Lately, here at Tryolabs, we started gaining interest in big data and search related platforms which are giving us excellent resources to create our complex web applications. On">
<meta name="keywords" content="python,elasticsearch">
<meta property="og:type" content="article">
<meta property="og:title" content="使用python操作elasticsearch">
<meta property="og:url" content="http://yangguoqi.me/2016/12/13/使用python操作elasticsearch/index.html">
<meta property="og:site_name" content="杨子鳄的小窝">
<meta property="og:description" content="和你们这些少爷不同，我们光是活着就竭尽全力了。Lately, here at Tryolabs, we started gaining interest in big data and search related platforms which are giving us excellent resources to create our complex web applications. On">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2016-12-13T02:30:40.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用python操作elasticsearch">
<meta name="twitter:description" content="和你们这些少爷不同，我们光是活着就竭尽全力了。Lately, here at Tryolabs, we started gaining interest in big data and search related platforms which are giving us excellent resources to create our complex web applications. On">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> 使用python操作elasticsearch | 杨子鳄的小窝 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>
    <a target="_blank" href="https://github.com/lnmput"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">杨子鳄的小窝</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-read">
          <a href="/read" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            读书
          </a>
        </li>
      
        
        <li class="menu-item menu-item-translate">
          <a href="/tags/translate" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-file"></i> <br />
            
            翻译
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            简历
          </a>
        </li>
      
        
        <li class="menu-item menu-item-project">
          <a href="/project" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-thumbs-up"></i> <br />
            
            项目
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                使用python操作elasticsearch
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-13T10:19:01+08:00" content="2016-12-13">
              2016-12-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><blockquote class="blockquote-center"><br>和你们这些少爷不同，我们光是活着就竭尽全力了。<br></blockquote><br>Lately, here at Tryolabs, we started gaining interest in big data and search related platforms which are giving us excellent resources to create our complex web applications. One of them is Elasticsearch.<br>Elastic{ON}15, the first ES conference is coming, and since nowadays we see a lot of interest in this technology, we are taking the opportunity to give an introduction and a simple example for Python developers out there that want to begin using it or give it a try.</p>
<h3 id="1-What-is-Elasticsearch"><a href="#1-What-is-Elasticsearch" class="headerlink" title="1. What is Elasticsearch?"></a>1. What is Elasticsearch?</h3><p>Elasticsearch is a distributed, real-time, search and analytics platform.</p>
<h3 id="2-Yeah-but-what-IS-Elasticsearch"><a href="#2-Yeah-but-what-IS-Elasticsearch" class="headerlink" title="2. Yeah, but what IS Elasticsearch?"></a>2. Yeah, but what IS Elasticsearch?</h3><p>Good question! In the previous definition you can see all these hype-sounding tech terms (distributed, real-time, analytics), so let’s try to explain.<br>ES is distributed, it organizes information in clusters of nodes, so it will run in multiple servers if we intend it to.<br>ES is real-time, since data is indexed, we get responses to our queries super fast!<br>And last but not least, it does searches and analytics. The main problem we are solving with this tool is exploring our data!<br>A platform like ES is the foundation for any respectable search engine.</p>
<h3 id="3-How-does-it-work"><a href="#3-How-does-it-work" class="headerlink" title="3. How does it work?"></a>3. How does it work?</h3><p>Using a restful API, Elasticsearch saves data and indexes it automatically. It assigns types to fields and that way a search can be done smartly and quickly using filters and different queries.<br>It’s uses JVM in order to be as fast as possible. It distributes indexes in “shards” of data. It replicates shards in different nodes, so it’s distributed and clusters can function even if not all nodes are operational. Adding nodes is super easy and that’s what makes it so scalable.<br>ES uses Lucene to solve searches. This is quite an advantage with comparing with, for example, Django query strings. A restful API call allows us to perform searches using json objects as parameters, making it much more flexible and giving each search parameter within the object a different weight, importance and or priority.<br>The final result ranks objects that comply with the search query requirements. You could even use synonyms, autocompletes, spell suggestions and correct typos. While the usual query strings provides results that follow certain logic rules, ES queries give you a ranked list of results that may fall in different criteria and its order depend on how they comply with a certain rule or filter.<br>ES can also provide answers for data analysis, like averages, how many unique terms and or statistics. This could be done using aggregations. To dig a little deeper in this feature check the documentation here.</p>
<h3 id="4-Should-I-use-ES"><a href="#4-Should-I-use-ES" class="headerlink" title="4. Should I use ES?"></a>4. Should I use ES?</h3><p>The main point is scalability and getting results and insights very fast. In most cases using Lucene could be enough to have all you need.<br>It seems sometimes that these tools are designed for projects with tons of data and are distributed in order to handle tons of users. Startups dream of growing to that scenario, but may start thinking small first to build a prototype and then when the data is there, start thinking about scaling problems.<br>Does it make sense and pays off to be prepared to grow A LOT? Why not? Elasticsearch has no drawback and is easy to use, so it’s just a decision of using it to be prepared for the future.<br>I’m going to give you a quick example of a dead simple project using Elasticsearch to quickly and beautifully search for some example data. It will be quick to do, Python powered and ready to scale in case we need it to, so, best of both worlds.</p>
<h3 id="5-Easy-first-steps-with-ES"><a href="#5-Easy-first-steps-with-ES" class="headerlink" title="5. Easy first steps with ES"></a>5. Easy first steps with ES</h3><p>For the following part it would be nice to be familiarized with concepts like Cluster, Node, Document, Index. Take a look at the official guide if you have doubts.<br>First things first, get ES from here.<br>I followed this video tutorial to get things started in just a minute. I recommend all you to check it out later.<br>Once you downloaded ES, it’s as simple as running bin/elasticsearch and you will have your ES cluster with one node running! You can interact with it at <a href="http://localhost:9200/" target="_blank" rel="external">http://localhost:9200/</a><br>If you hit it you will get something like this:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"status"</span> : <span class="number">200</span>,</div><div class="line">  <span class="attr">"name"</span> : <span class="string">"Delphine Courtney"</span>,</div><div class="line">  <span class="attr">"cluster_name"</span> : <span class="string">"elasticsearch"</span>,</div><div class="line">  <span class="attr">"version"</span> : &#123;</div><div class="line">    <span class="attr">"number"</span> : <span class="string">"1.4.2"</span>,</div><div class="line">    <span class="attr">"build_hash"</span> : <span class="string">"927caff6f05403e936c20bf4529f144f0c89fd8c"</span>,</div><div class="line">    <span class="attr">"build_timestamp"</span> : <span class="string">"2014-12-16T14:11:12Z"</span>,</div><div class="line">    <span class="attr">"build_snapshot"</span> : <span class="literal">false</span>,</div><div class="line">    <span class="attr">"lucene_version"</span> : <span class="string">"4.10.2"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"tagline"</span> : <span class="string">"You Know, for Search"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>view rawes_first.json hosted with ❤ by GitHub<br>Creating another node is as simple as:<br>bin/elasticsearch -Des.node.name=Node-2<br>It automatically detects the old node as its master and joins our cluster. By default we will be able to communicate with this new node using the 9201 port <a href="http://localhost:9201" target="_blank" rel="external">http://localhost:9201</a>. Now we can talk with each node and receive the same data, they are supposed to be identical.</p>
<h3 id="6-Let’s-Pythonize-this-thing"><a href="#6-Let’s-Pythonize-this-thing" class="headerlink" title="6. Let’s Pythonize this thing!"></a>6. Let’s Pythonize this thing!</h3><p>To use ES with our all time favorite language; Python, it gets easier if we install elasticsearch-py package.<br>pip install elasticsearch<br>Now we will be able to use this package to index and search data using Python.</p>
<h3 id="7-Let’s-add-some-public-data-to-our-cluster"><a href="#7-Let’s-add-some-public-data-to-our-cluster" class="headerlink" title="7. Let’s add some public data to our cluster"></a>7. Let’s add some public data to our cluster</h3><p>So, I wanted to make this project a “real world example”, I really did, but after I found out there is a star wars API (<a href="http://swapi.co/" target="_blank" rel="external">http://swapi.co/</a>), I couldn’t resist it and ended up being a fictional -  ”galaxy far far away” example.  The API is dead simple to use, so we will get some data from there.<br>I’m using an IPython Notebook to do this test, I started with the sample request to make sure we can hit the ES server.</p>
<h1 id="make-sure-ES-is-up-and-running"><a href="#make-sure-ES-is-up-and-running" class="headerlink" title="make sure ES is up and running"></a>make sure ES is up and running</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line">res = requests.get(<span class="string">'http://localhost:9200'</span>)</div><div class="line">print(res.content)</div></pre></td></tr></table></figure>
<p>view rawes_first.py hosted with ❤ by GitHub<br>Then we connect to our ES server using Python and the elasticsearch-py library:</p>
<p>#connect to our cluster<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> elasticsearch <span class="keyword">import</span> Elasticsearch</div><div class="line">es = Elasticsearch([&#123;<span class="string">'host'</span>: <span class="string">'localhost'</span>, <span class="string">'port'</span>: <span class="number">9200</span>&#125;])</div></pre></td></tr></table></figure></p>
<p>view rawes_first3.py hosted with ❤ by GitHub<br>I added some data to test, and then deleted it. I’m skipping that part for this guide, but you can check it out in the notebook.<br>Now, using The Force, we connect to the Star Wars API and index some fictional people.</p>
<p>#let’s iterate over swapi people documents and index them<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> json</div><div class="line">r = requests.get(<span class="string">'http://localhost:9200'</span>) </div><div class="line">i = <span class="number">1</span></div><div class="line"><span class="keyword">while</span> r.status_code == <span class="number">200</span>:</div><div class="line">    r = requests.get(<span class="string">'http://swapi.co/api/people/'</span>+ str(i))</div><div class="line">    es.index(index=<span class="string">'sw'</span>, doc_type=<span class="string">'people'</span>, id=i, body=json.loads(r.content))</div><div class="line">    i=i+<span class="number">1</span></div><div class="line"> </div><div class="line">print(i)</div></pre></td></tr></table></figure></p>
<p>view rawes_first4.py hosted with ❤ by GitHub<br>Please, notice that we automatically created an index “sw” and a “doc_type” with de indexing command. We get 17 responses from swapi and index them with ES. I’m sure there are much more “people” in the swapi DB, but it seems we are getting a 404 with <a href="http://swapi.co/api/people/17" target="_blank" rel="external">http://swapi.co/api/people/17</a>. Bug report here! :-)<br>Anyway, to see if all worked with this few results, we try to get the document with id=5.<br>es.get(index=’sw’, doc_type=’people’, id=5)<br>view rawes_first10.py hosted with ❤ by GitHub<br>We will get Princess Leia:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&#123;u'_id': u'5',</div><div class="line"> u'_index': u'sw',</div><div class="line"> u'_source': &#123;u'birth_year': u'19BBY',</div><div class="line">  u'created': u'2014-12-10T15:20:09.791000Z',</div><div class="line">  u'edited': u'2014-12-20T21:17:50.315000Z',</div><div class="line">  u'eye_color': u'brown',</div><div class="line">  u'films': [u'http://swapi.co/api/films/1/',</div><div class="line">   u'http://swapi.co/api/films/2/',</div><div class="line">   u'http://swapi.co/api/films/3/',</div><div class="line">   u'http://swapi.co/api/films/6/'],</div><div class="line">  u'gender': u'female',</div><div class="line">  u'hair_color': u'brown',</div><div class="line">  u'height': u'150',</div><div class="line">  u'homeworld': u'http://swapi.co/api/planets/2/',</div><div class="line">  u'mass': u'49',</div><div class="line">  u'name': u'Leia Organa',</div><div class="line">  u'skin_color': u'light',</div><div class="line">  u'species': [u'http://swapi.co/api/species/1/'],</div><div class="line">  u'starships': [],</div><div class="line">  u'url': u'http://swapi.co/api/people/5/',</div><div class="line">  u'vehicles': [u'http://swapi.co/api/vehicles/30/']&#125;,</div><div class="line"> u'_type': u'people',</div><div class="line"> u'_version': 1,</div><div class="line"> u'found': True&#125;</div></pre></td></tr></table></figure></p>
<p>view rawes_first5.py hosted with ❤ by GitHub<br>Now, let’s add more data, this time using node 2! And let’s start at the 18th person, where we stopped.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">r = requests.get(<span class="string">'http://localhost:9201'</span>)</div><div class="line">i = <span class="number">18</span></div><div class="line"><span class="keyword">while</span> r.status_code == <span class="number">200</span>:</div><div class="line">   r = requests.get(<span class="string">'http://swapi.co/api/people/'</span>+ str(i))</div><div class="line">   es.index(index=<span class="string">'sw'</span>, doc_type=<span class="string">'people'</span>, id=i,     body=json.loads(r.content))</div><div class="line">   i=i+<span class="number">1</span></div></pre></td></tr></table></figure></p>
<p>view rawes_first6.py hosted with ❤ by GitHub<br>We got the rest of the characters just fine.</p>
<h3 id="8-Now-let’s-try-an-interesting-search"><a href="#8-Now-let’s-try-an-interesting-search" class="headerlink" title="8. Now, let’s try an interesting search"></a>8. Now, let’s try an interesting search</h3><p>Where is Darth Vader? Here is our search query:<br>es.search(index=”sw”, body={“query”: {“match”: {‘name’:’Darth Vader’}}})<br>view rawes_first7.py hosted with ❤ by GitHub<br>This will give us both Darth Vader AND Darth Maul. Id 4 and id 44 (notice that they are in the same index, even if we use different node client call the index command). Both results have a score, although Darth Vader is much higher than Darth Maul (2.77 vs 0.60) since Vader is a exact match. Take that Darth Maul!<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line">&#123;u'_shards': &#123;u'failed': 0, u'successful': 5, u'total': 5&#125;,</div><div class="line"> u'hits': &#123;u'hits': [&#123;u'_id': u'4',</div><div class="line">    u'_index': u'sw',</div><div class="line">    u'_score': 2.7754524,</div><div class="line">    u'_source': &#123;u'birth_year': u'41.9BBY',</div><div class="line">     u'created': u'2014-12-10T15:18:20.704000Z',</div><div class="line">     u'edited': u'2014-12-20T21:17:50.313000Z',</div><div class="line">     u'eye_color': u'yellow',</div><div class="line">     u'films': [u'http://swapi.co/api/films/1/',</div><div class="line">      u'http://swapi.co/api/films/2/',</div><div class="line">      u'http://swapi.co/api/films/3/',</div><div class="line">      u'http://swapi.co/api/films/6/'],</div><div class="line">     u'gender': u'male',</div><div class="line">     u'hair_color': u'none',</div><div class="line">     u'height': u'202',</div><div class="line">     u'homeworld': u'http://swapi.co/api/planets/1/',</div><div class="line">     u'mass': u'136',</div><div class="line">     u'name': u'Darth Vader',</div><div class="line">     u'skin_color': u'white',</div><div class="line">     u'species': [u'http://swapi.co/api/species/1/'],</div><div class="line">     u'starships': [u'http://swapi.co/api/starships/13/'],</div><div class="line">     u'url': u'http://swapi.co/api/people/4/',</div><div class="line">     u'vehicles': []&#125;,</div><div class="line">    u'_type': u'people'&#125;,</div><div class="line">   &#123;u'_id': u'44',</div><div class="line">    u'_index': u'sw',</div><div class="line">    u'_score': 0.6085256,</div><div class="line">    u'_source': &#123;u'birth_year': u'54BBY',</div><div class="line">     u'created': u'2014-12-19T18:00:41.929000Z',</div><div class="line">     u'edited': u'2014-12-20T21:17:50.403000Z',</div><div class="line">     u'eye_color': u'yellow',</div><div class="line">     u'films': [u'http://swapi.co/api/films/4/'],</div><div class="line">     u'gender': u'male',</div><div class="line">     u'hair_color': u'none',</div><div class="line">     u'height': u'175',</div><div class="line">     u'homeworld': u'http://swapi.co/api/planets/36/',</div><div class="line">     u'mass': u'80',</div><div class="line">     u'name': u'Darth Maul',</div><div class="line">     u'skin_color': u'red',</div><div class="line">     u'species': [u'http://swapi.co/api/species/22/'],</div><div class="line">     u'starships': [u'http://swapi.co/api/starships/41/'],</div><div class="line">     u'url': u'http://swapi.co/api/people/44/',</div><div class="line">     u'vehicles': [u'http://swapi.co/api/vehicles/42/']&#125;,</div><div class="line">    u'_type': u'people'&#125;],</div><div class="line">  u'max_score': 2.7754524,</div><div class="line">  u'total': 2&#125;,</div><div class="line"> u'timed_out': False,</div><div class="line"> u'took': 44&#125;</div><div class="line">``` </div><div class="line">view rawes_first8.py hosted with ❤ by GitHub</div><div class="line">So, this query will give us results if the word is contained exactly in our indexed data. What if we want to build some kind of autocomplete input where we get the names that contain the characters we are typing?</div><div class="line">There are many ways to do that and another great number of queries. Take a look here to learn more. I picked this one to get all documents with prefix “lu” in their name field:</div><div class="line">`es.search(index="sw", body=&#123;"query": &#123;"prefix" : &#123; "name" : "lu" &#125;&#125;&#125;)`</div><div class="line">view rawes_first9.py hosted with ❤ by GitHub</div><div class="line">We will get Luke Skywalker and Luminara Unduli, both with the same 1.0 score, since they match with the same 2 initial characters.</div><div class="line">```json</div><div class="line">&#123;u'_shards': &#123;u'failed': 0, u'successful': 5, u'total': 5&#125;,</div><div class="line"> u'hits': &#123;u'hits': [&#123;u'_id': u'1',</div><div class="line">    u'_index': u'sw',</div><div class="line">    u'_score': 1.0,</div><div class="line">    u'_source': &#123;u'birth_year': u'19BBY',</div><div class="line">     u'created': u'2014-12-09T13:50:51.644000Z',</div><div class="line">     u'edited': u'2014-12-20T21:17:56.891000Z',</div><div class="line">     u'eye_color': u'blue',</div><div class="line">     u'films': [u'http://swapi.co/api/films/1/',</div><div class="line">      u'http://swapi.co/api/films/2/',</div><div class="line">      u'http://swapi.co/api/films/3/',</div><div class="line">      u'http://swapi.co/api/films/6/'],</div><div class="line">     u'gender': u'male',</div><div class="line">     u'hair_color': u'blond',</div><div class="line">     u'height': u'172',</div><div class="line">     u'homeworld': u'http://swapi.co/api/planets/1/',</div><div class="line">     u'mass': u'77',</div><div class="line">     u'name': u'Luke Skywalker',</div><div class="line">     u'skin_color': u'fair',</div><div class="line">     u'species': [u'http://swapi.co/api/species/1/'],</div><div class="line">     u'starships': [u'http://swapi.co/api/starships/12/',</div><div class="line">      u'http://swapi.co/api/starships/22/'],</div><div class="line">     u'url': u'http://swapi.co/api/people/1/',</div><div class="line">     u'vehicles': [u'http://swapi.co/api/vehicles/14/',</div><div class="line">      u'http://swapi.co/api/vehicles/30/']&#125;,</div><div class="line">    u'_type': u'people'&#125;,</div><div class="line">   &#123;u'_id': u'64',</div><div class="line">    u'_index': u'sw',</div><div class="line">    u'_score': 1.0,</div><div class="line">    u'_source': &#123;u'birth_year': u'58BBY',</div><div class="line">     u'created': u'2014-12-20T16:45:53.668000Z',</div><div class="line">     u'edited': u'2014-12-20T21:17:50.455000Z',</div><div class="line">     u'eye_color': u'blue',</div><div class="line">     u'films': [u'http://swapi.co/api/films/5/',</div><div class="line">      u'http://swapi.co/api/films/6/'],</div><div class="line">     u'gender': u'female',</div><div class="line">     u'hair_color': u'black',</div><div class="line">     u'height': u'170',</div><div class="line">     u'homeworld': u'http://swapi.co/api/planets/51/',</div><div class="line">     u'mass': u'56.2',</div><div class="line">     u'name': u'Luminara Unduli',</div><div class="line">     u'skin_color': u'yellow',</div><div class="line">     u'species': [u'http://swapi.co/api/species/29/'],</div><div class="line">     u'starships': [],</div><div class="line">     u'url': u'http://swapi.co/api/people/64/',</div><div class="line">     u'vehicles': []&#125;,</div><div class="line">    u'_type': u'people'&#125;],</div><div class="line">  u'max_score': 1.0,</div><div class="line">  u'total': 2&#125;,</div><div class="line"> u'timed_out': False,</div><div class="line"> u'took': 9&#125;</div></pre></td></tr></table></figure></p>
<p>view rawes_first11.py hosted with ❤ by GitHub<br>There are many other interesting queries we can do. If, for example, we want to get all elements similar in some way, for a related or correction search we can use something like this:<br>es.search(index=”sw”, body={“query”:<br>{“fuzzy_like_this_field” : { “name” :<br>{“like_text”: “jaba”, “max_query_terms”:5}}}})<br>view rawes_first1.py hosted with ❤ by GitHub<br>And we got Jabba although we had a typo in our search query. That is powerful!<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&#123;u'_shards': &#123;u'failed': 0, u'successful': 5, u'total': 5&#125;,</div><div class="line"> u'hits': &#123;u'hits': [&#123;u'_id': u'16',</div><div class="line">    u'_index': u'sw',</div><div class="line">    u'_score': 1.5700331,</div><div class="line">    u'_source': &#123;u'birth_year': u'600BBY',</div><div class="line">     u'created': u'2014-12-10T17:11:31.638000Z',</div><div class="line">     u'edited': u'2014-12-20T21:17:50.338000Z',</div><div class="line">     u'eye_color': u'orange',</div><div class="line">     u'films': [u'http://swapi.co/api/films/1/',</div><div class="line">      u'http://swapi.co/api/films/3/',</div><div class="line">      u'http://swapi.co/api/films/4/'],</div><div class="line">     u'gender': u'hermaphrodite',</div><div class="line">     u'hair_color': u'n/a',</div><div class="line">     u'height': u'175',</div><div class="line">     u'homeworld': u'http://swapi.co/api/planets/24/',</div><div class="line">     u'mass': u'1,358',</div><div class="line">     u'name': u'Jabba Desilijic Tiure',</div><div class="line">     u'skin_color': u'green-tan, brown',</div><div class="line">     u'species': [u'http://swapi.co/api/species/5/'],</div><div class="line">     u'starships': [],</div><div class="line">     u'url': u'http://swapi.co/api/people/16/',</div><div class="line">     u'vehicles': []&#125;,</div><div class="line">    u'_type': u'people'&#125;],</div><div class="line">  u'max_score': 1.5700331,</div><div class="line">  u'total': 1&#125;,</div><div class="line"> u'timed_out': False,</div><div class="line"> u'took': 40&#125;</div></pre></td></tr></table></figure></p>
<p>view rawes_first2.py hosted with ❤ by GitHub</p>
<h3 id="9-Next-Steps"><a href="#9-Next-Steps" class="headerlink" title="9. Next Steps"></a>9. Next Steps</h3><p>This was just a simple overview on how to set up your Elasticsearch server and start working with some data using Python. The code used here is publicly available in this IPython notebook.<br>We encourage you to learn more about ES and specially take a look at the Elastic stack where you will be able to see beautiful analytics and insights with Kibana and go through logs using Logstash.<br>In following posts we will talk about more advanced ES features and we will try to extend this simple test and use it to show a more interesting Django app powered by this data and by ES.<br>Hope this post was useful for developers trying to enter the ES world.<br>At Tryolabs we’re Elastic official partners. If you want to talk about Elasticsearch, ELK, applications and possible projects using these technologies, drop us a line to hello@tryolabs.com (or fill out this form) and we will be glad to connect!</p>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/python/" rel="tag">#python</a>
          
            <a href="/tags/elasticsearch/" rel="tag">#elasticsearch</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/12/12/javascript中作用域和变量提升/" rel="next" title="javascript中作用域和变量提升">
                <i class="fa fa-chevron-left"></i> javascript中作用域和变量提升
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/12/13/用matplotlib绘制精美的图表/" rel="prev" title="用matplotlib绘制精美的图表">
                用matplotlib绘制精美的图表 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="lnmput@gmail.com" />
          <p class="site-author-name" itemprop="name">lnmput@gmail.com</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">219</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">101</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/lnmput" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.laruence.com/" title="风雪之隅" target="_blank">风雪之隅</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://tech.youzan.com/" title="有赞技术团队" target="_blank">有赞技术团队</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://tech.meituan.com/archives" title="美团点评技术团队" target="_blank">美团点评技术团队</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://macshuo.com/" title="點燈坊" target="_blank">點燈坊</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.turn.tw/" title="轉個彎日誌" target="_blank">轉個彎日誌</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-What-is-Elasticsearch"><span class="nav-number">1.</span> <span class="nav-text">1. What is Elasticsearch?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Yeah-but-what-IS-Elasticsearch"><span class="nav-number">2.</span> <span class="nav-text">2. Yeah, but what IS Elasticsearch?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-How-does-it-work"><span class="nav-number">3.</span> <span class="nav-text">3. How does it work?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-Should-I-use-ES"><span class="nav-number">4.</span> <span class="nav-text">4. Should I use ES?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Easy-first-steps-with-ES"><span class="nav-number">5.</span> <span class="nav-text">5. Easy first steps with ES</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-Let’s-Pythonize-this-thing"><span class="nav-number">6.</span> <span class="nav-text">6. Let’s Pythonize this thing!</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-Let’s-add-some-public-data-to-our-cluster"><span class="nav-number">7.</span> <span class="nav-text">7. Let’s add some public data to our cluster</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#make-sure-ES-is-up-and-running"><span class="nav-number"></span> <span class="nav-text">make sure ES is up and running</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-Now-let’s-try-an-interesting-search"><span class="nav-number">1.</span> <span class="nav-text">8. Now, let’s try an interesting search</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-Next-Steps"><span class="nav-number">2.</span> <span class="nav-text">9. Next Steps</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lnmput@gmail.com</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  



  
  
  

  

  

</body>
</html>
