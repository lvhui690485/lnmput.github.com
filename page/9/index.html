<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="杨子鳄的小窝">
<meta property="og:url" content="http://yangguoqi.me/page/9/index.html">
<meta property="og:site_name" content="杨子鳄的小窝">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="杨子鳄的小窝">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> 杨子鳄的小窝 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>
    <a target="_blank" href="https://github.com/lnmput"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">杨子鳄的小窝</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-read">
          <a href="/read" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            读书
          </a>
        </li>
      
        
        <li class="menu-item menu-item-translate">
          <a href="/tags/translate" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-file"></i> <br />
            
            翻译
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            简历
          </a>
        </li>
      
        
        <li class="menu-item menu-item-project">
          <a href="/project" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-thumbs-up"></i> <br />
            
            项目
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/28/强大的下拉框插件Select2/" itemprop="url">
                  强大的下拉框插件Select2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-09-28T09:25:20+08:00" content="2017-09-28">
              2017-09-28
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><blockquote class="blockquote-center"><br>每个人都是他人生的主角，<br>可是一旦沦为配角，就是他最伤心的时候。<br></blockquote><br>select2是一个可以给你定制支持搜索、标签、远程数据集，无限滚动，以及其他常用功能的一个下拉框美化插件。总之，功能很强大。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2/css/select2.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2/js/select2.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">$(<span class="string">'select'</span>).select2();</span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="单选框"><a href="#单选框" class="headerlink" title="单选框"></a>单选框</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></div><div class="line"><span class="javascript">$(<span class="string">".js-example-basic-single"</span>).select2();</span></div><div class="line"><span class="undefined">&#125;);</span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"js-example-basic-single"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"AL"</span>&gt;</span>Alabama<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line"> ...</div><div class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"WY"</span>&gt;</span>Wyoming<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="多选框"><a href="#多选框" class="headerlink" title="多选框"></a>多选框</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">$(<span class="string">".js-example-basic-multiple"</span>).select2();</span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"js-example-basic-multiple"</span> <span class="attr">multiple</span>=<span class="string">"multiple"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"AL"</span>&gt;</span>Alabama<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">...</div><div class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"WY"</span>&gt;</span>Wyoming<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="提示信息"><a href="#提示信息" class="headerlink" title="提示信息"></a>提示信息</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$(".js-example-placeholder-single").select2(&#123;</div><div class="line">placeholder: "Select a state",</div><div class="line">allowClear: true //可以删除</div><div class="line">&#125;);</div><div class="line">$(".js-example-placeholder-multiple").select2(&#123;</div><div class="line">placeholder: "Select a state"</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="加载数组"><a href="#加载数组" class="headerlink" title="加载数组"></a>加载数组</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript"><span class="keyword">var</span> data = [</span></div><div class="line"><span class="javascript">&#123; id: <span class="number">0</span>, text: <span class="string">'enhancement'</span> &#125;,</span></div><div class="line"><span class="javascript">&#123; id: <span class="number">1</span>, text: <span class="string">'bug'</span> &#125;,</span></div><div class="line"><span class="javascript">&#123; id: <span class="number">2</span>, text: <span class="string">'duplicate'</span> &#125;,</span></div><div class="line"><span class="javascript">&#123; id: <span class="number">3</span>, text: <span class="string">'invalid'</span> &#125;,</span></div><div class="line"><span class="javascript">&#123; id: <span class="number">4</span>, text: <span class="string">'wontfix'</span> &#125;];</span></div><div class="line"><span class="javascript">$(<span class="string">".js-example-data-array"</span>).select2(&#123;</span></div><div class="line"><span class="undefined">data: data</span></div><div class="line"><span class="undefined">&#125;)</span></div><div class="line"><span class="javascript">$(<span class="string">".js-example-data-array-selected"</span>).select2(&#123;</span></div><div class="line"><span class="undefined">data: data</span></div><div class="line"><span class="undefined">&#125;)</span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"js-example-data-array"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"js-example-data-array-selected"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"2"</span> <span class="attr">selected</span>=<span class="string">"selected"</span>&gt;</span>duplicate<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="加载远程数据"><a href="#加载远程数据" class="headerlink" title="加载远程数据"></a>加载远程数据</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">$(".js-data-example-ajax").select2(&#123;</div><div class="line">ajax: &#123;</div><div class="line"> url: "https://api.github.com/search/repositories",</div><div class="line"> dataType: 'json',</div><div class="line"> delay: 250,</div><div class="line"> data: function (params) &#123;</div><div class="line"> return &#123;</div><div class="line"> q: params.term, // search term</div><div class="line"> page: params.page</div><div class="line"> &#125;;</div><div class="line"> &#125;,</div><div class="line"> processResults: function (data, params) &#123;</div><div class="line"> // parse the results into the format expected by Select2</div><div class="line"> // since we are using custom formatting functions we do not need to</div><div class="line"> // alter the remote JSON data, except to indicate that infinite</div><div class="line"> // scrolling can be used</div><div class="line"> params.page = params.page || 1;</div><div class="line"> return &#123;</div><div class="line"> results: data.items,</div><div class="line"> pagination: &#123;</div><div class="line"> more: (params.page * 30) <span class="tag">&lt; <span class="attr">data.total_count</span></span></div><div class="line"><span class="tag"> &#125;</span></div><div class="line"><span class="tag"> &#125;;</span></div><div class="line"><span class="tag"> &#125;,</span></div><div class="line"><span class="tag"> <span class="attr">cache:</span> <span class="attr">true</span></span></div><div class="line"><span class="tag">&#125;,</span></div><div class="line"><span class="tag"><span class="attr">escapeMarkup:</span> <span class="attr">function</span> (<span class="attr">markup</span>) &#123; <span class="attr">return</span> <span class="attr">markup</span>; &#125;, // <span class="attr">let</span> <span class="attr">our</span> <span class="attr">custom</span> <span class="attr">formatter</span> <span class="attr">work</span></span></div><div class="line"><span class="tag"><span class="attr">minimumInputLength:</span> <span class="attr">1</span>,</span></div><div class="line"><span class="tag"><span class="attr">templateResult:</span> <span class="attr">formatRepo</span>, // <span class="attr">omitted</span> <span class="attr">for</span> <span class="attr">brevity</span>, <span class="attr">see</span> <span class="attr">the</span> <span class="attr">source</span> <span class="attr">of</span> <span class="attr">this</span> <span class="attr">page</span></span></div><div class="line"><span class="tag"><span class="attr">templateSelection:</span> <span class="attr">formatRepoSelection</span> // <span class="attr">omitted</span> <span class="attr">for</span> <span class="attr">brevity</span>, <span class="attr">see</span> <span class="attr">the</span> <span class="attr">source</span> <span class="attr">of</span> <span class="attr">this</span> <span class="attr">page</span></span></div><div class="line"><span class="tag">&#125;);</span></div></pre></td></tr></table></figure>
<h3 id="禁用模式"><a href="#禁用模式" class="headerlink" title="禁用模式"></a>禁用模式</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$(".js-programmatic-enable").on("click", function () &#123;</div><div class="line"> $(".js-example-disabled").prop("disabled", false);</div><div class="line"> $(".js-example-disabled-multi").prop("disabled", false);</div><div class="line">&#125;);</div><div class="line">$(".js-programmatic-disable").on("click", function () &#123;</div><div class="line"> $(".js-example-disabled").prop("disabled", true);</div><div class="line"> $(".js-example-disabled-multi").prop("disabled", true);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="禁用结果"><a href="#禁用结果" class="headerlink" title="禁用结果"></a>禁用结果</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"js-example-disabled-results"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"one"</span>&gt;</span>First<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"two"</span> <span class="attr">disabled</span>=<span class="string">"disabled"</span>&gt;</span>Second (disabled)<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"three"</span>&gt;</span>Third<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="限制个数"><a href="#限制个数" class="headerlink" title="限制个数"></a>限制个数</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(".js-example-basic-multiple-limit").select2(&#123;</div><div class="line"> maximumSelectionLength: 2</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="隐藏搜索框"><a href="#隐藏搜索框" class="headerlink" title="隐藏搜索框"></a>隐藏搜索框</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(".js-example-basic-hide-search").select2(&#123;</div><div class="line">minimumResultsForSearch: Infinity</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="DOM事件"><a href="#DOM事件" class="headerlink" title="DOM事件"></a>DOM事件</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">change //选中或删除触发</div><div class="line">select2:open //下拉框打开触发</div><div class="line">select2:opening //下拉框打开之前</div><div class="line">select2:close //下拉框关闭</div><div class="line">select2:closing //下拉框关闭之前</div><div class="line">select2:select //选中结果触发</div><div class="line">select2:selecting //选中之前</div><div class="line">select2:unselect //结果未选中</div><div class="line">select2:unselecting //结果未选中之前</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">var $eventLog = $(".js-event-log");</div><div class="line">var $eventSelect = $(".js-example-events");</div><div class="line">$eventSelect.on("select2:open", function (e) &#123; log("select2:open", e); &#125;);</div><div class="line">$eventSelect.on("select2:close", function (e) &#123; log("select2:close", e); &#125;);</div><div class="line">$eventSelect.on("select2:select", function (e) &#123; log("select2:select", e); &#125;);</div><div class="line">$eventSelect.on("select2:unselect", function (e) &#123; log("select2:unselect", e); &#125;);</div><div class="line">$eventSelect.on("change", function (e) &#123; log("change"); &#125;);</div><div class="line">function log (name, evt) &#123;</div><div class="line">if (!evt) &#123;</div><div class="line"> var args = "&#123;&#125;";</div><div class="line">&#125; else &#123;</div><div class="line"> var args = JSON.stringify(evt.params, function (key, value) &#123;</div><div class="line"> if (value &amp;&amp; value.nodeName) return "[DOM node]";</div><div class="line"> if (value instanceof $.Event) return "[$.Event]";</div><div class="line"> return value;</div><div class="line"> &#125;);</div><div class="line">&#125;</div><div class="line">var $e = $("<span class="tag">&lt;<span class="name">li</span>&gt;</span>" + name + " -&gt; " + args + "<span class="tag">&lt;/<span class="name">li</span>&gt;</span>");</div><div class="line">$eventLog.append($e);</div><div class="line">$e.animate(&#123; opacity: 1 &#125;, 10000, 'linear', function () &#123;</div><div class="line"> $e.animate(&#123; opacity: 0 &#125;, 2000, 'linear', function () &#123;</div><div class="line"> $e.remove();</div><div class="line"> &#125;);</div><div class="line">&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="自定义控制"><a href="#自定义控制" class="headerlink" title="自定义控制"></a>自定义控制</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">var $example = $(".js-example-programmatic").select2();</div><div class="line">var $exampleMulti = $(".js-example-programmatic-multi").select2();</div><div class="line">$(".js-programmatic-set-val").on("click", function () &#123; $example.val("CA").trigger("change"); &#125;);</div><div class="line">$(".js-programmatic-open").on("click", function () &#123; $example.select2("open"); &#125;);</div><div class="line">$(".js-programmatic-close").on("click", function () &#123; $example.select2("close"); &#125;);</div><div class="line">$(".js-programmatic-init").on("click", function () &#123; $example.select2(); &#125;);</div><div class="line">$(".js-programmatic-destroy").on("click", function () &#123; $example.select2("destroy"); &#125;);</div><div class="line">$(".js-programmatic-multi-set-val").on("click", function () &#123; $exampleMulti.val(["CA", "AL"]).trigger("change"); &#125;);</div><div class="line">$(".js-programmatic-multi-clear").on("click", function () &#123; $exampleMulti.val(null).trigger("change"); &#125;);</div></pre></td></tr></table></figure>
<h3 id="标签支持"><a href="#标签支持" class="headerlink" title="标签支持"></a>标签支持</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(".js-example-tags").select2(&#123;</div><div class="line"> tags: true</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="自动标记"><a href="#自动标记" class="headerlink" title="自动标记"></a>自动标记</h3><p>当我们输入值匹配成功后 键入空格就会自动标签化<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$(".js-example-tokenizer").select2(&#123;</div><div class="line"> tags: true,</div><div class="line"> tokenSeparators: [',', ' ']</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="自定义查找匹配"><a href="#自定义查找匹配" class="headerlink" title="自定义查找匹配"></a>自定义查找匹配</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">function matchStart (term, text) &#123;</div><div class="line"> if (text.toUpperCase().indexOf(term.toUpperCase()) == 0) &#123;</div><div class="line"> return true;</div><div class="line"> &#125;</div><div class="line"> return false;</div><div class="line">&#125;</div><div class="line">$.fn.select2.amd.require(['select2/compat/matcher'],</div><div class="line"> function (oldMatcher) &#123;</div><div class="line"> $(".js-example-matcher-start").select2(&#123;</div><div class="line"> matcher: oldMatcher(matchStart)</div><div class="line"> &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://www.bandari.net/blog/14" target="_blank" rel="external">https://www.bandari.net/blog/14</a><br><a href="https://stackoverflow.com/questions/14577014/select2-dropdown-but-allow-new-values-by-user" target="_blank" rel="external">https://stackoverflow.com/questions/14577014/select2-dropdown-but-allow-new-values-by-user</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/25/PHPstudy升级mysql5-7方法/" itemprop="url">
                  PHPstudy升级mysql5.7方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-09-25T11:35:46+08:00" content="2017-09-25">
              2017-09-25
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><blockquote class="blockquote-center"><br>当我站在瀑布前，觉得非常的难过，我总觉得，应该是两个人站在这里<br></blockquote></p>
<h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><p>1.在mysql官网下载压缩包，我选取的是最新版的5.7.17连接：<a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="external">https://dev.mysql.com/downloads/mysql/</a><br>2.趁着下载的时间可以把之前的数据库数据备份下，我把 phpStudy 中 MySQL 文件夹可以重命名下，备用<br>3.把下载的 MySQL 压缩文件解压至 phpStudy 下的 MySQL目录，复制my-default.ini ，重命名为 my.ini。<br>4.打开 my.ini，找到 #basedir 处编辑：（我的安装在了C盘，路径根据phpstudy的安装路径选择）<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">basedir = C:\phpStudy7\MySQL</div><div class="line">datadir = C:\phpStudy7\MySQL\data</div></pre></td></tr></table></figure></p>
<p>5.在cmd下进入MySQL的bin目录（我的是 C:\phpStudy7\MySQL\bin），(初始化数据库：<code>mysqld --initialize</code>)</p>
<h3 id="错误解决"><a href="#错误解决" class="headerlink" title="错误解决"></a>错误解决</h3><h4 id="错误一"><a href="#错误一" class="headerlink" title="错误一"></a>错误一</h4><p>如果是timestamp的错误，在<code>my.ini</code>中添加<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[mysqld]</div><div class="line">explicit_defaults_for_timestamp=<span class="keyword">true</span></div></pre></td></tr></table></figure></p>
<h4 id="错误二"><a href="#错误二" class="headerlink" title="错误二"></a>错误二</h4><p>如果有[ERROR]mysqld:Error while setting value<br>‘’ONLY_FULL_GROUP_BY,NO_AUTO_VALUE_ON_ZERO,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,’to ‘sql_mode’<br>在my.ini中添加<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[mysqld]</div><div class="line">sql_mode=<span class="string">'NO_AUTO_VALUE_ON_ZERO,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION,PIPES_AS_CONCAT,ANSI_QUOTES'</span></div></pre></td></tr></table></figure></p>
<h4 id="错误三"><a href="#错误三" class="headerlink" title="错误三"></a>错误三</h4><p>如果是错误：initialize specified but the data directory has files in it.aborting<br>管理员身份运行cmd,然后cd至mysql下的bin，运行mysql install，然后就成功了<br>或者mysql中的data目录已经有数据了, 清空重新执行<br>执行完后，重启phpstudy</p>
<h4 id="错误四"><a href="#错误四" class="headerlink" title="错误四"></a>错误四</h4><p>此时登入 MySQL 报错：#1045 无法登录 MySQL 服务器，<br>打开 my.ini，找到 [mysqld]，在下面添加：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">skip-grant-tables <span class="comment">#(此参数用于忘记mysql密码)并保存</span></div></pre></td></tr></table></figure></p>
<p>此时使用 root 账号，密码处按回车即可登录。<br>如果想增加密码，在无密码的情况下进去mysql命令行，找到mysql数据库的user表：修改密码：<br>update user set authentication_string=’新密码’ where user=’root’ ;<br>此时仍然用root密码仍登录不进去的话，在phpstudy修改密码，原来的密码为空</p>
<blockquote>
<p><a href="http://www.jianshu.com/p/b238da2f9134" target="_blank" rel="external">http://www.jianshu.com/p/b238da2f9134</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/22/php实现跳转的一个坑/" itemprop="url">
                  php实现跳转的一个坑
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-09-22T10:14:53+08:00" content="2017-09-22">
              2017-09-22
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><blockquote class="blockquote-center"><br>被人看得见的努力,都是肤浅的努力<br></blockquote></p>
<h3 id="原文"><a href="#原文" class="headerlink" title="原文"></a>原文</h3><p>If you don’t put a die() or exit() after your header(‘Location: <a href="http://something" target="_blank" rel="external">http://something</a>‘) your script may continue resulting in unexpected behaviour. This may for example result in content being disclosed that you actually wanted to prevent with the redirect (HTTP 301). The aforementioned may not directly be visible for an end user as the browser may not render it (due to the 301). Conclusion, the exit() and die() functions stop the script from continuing.</p>
<h3 id="翻译"><a href="#翻译" class="headerlink" title="翻译"></a>翻译</h3><p>这句话的意思是说如果你不在header(‘Location: <a href="http://something&#39;)你的脚本后面加上" target="_blank" rel="external">http://something&#39;)你的脚本后面加上</a> die() 或者 exit(), 你的脚本就会继续向下执行,这样你的脚本就可能跳转不成功;</p>
<blockquote>
<p><a href="https://stackoverflow.com/questions/8665985/php-utilizing-exit-or-die-after-headerlocation" target="_blank" rel="external">https://stackoverflow.com/questions/8665985/php-utilizing-exit-or-die-after-headerlocation</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/21/swoole结合php实现多任务异步处理/" itemprop="url">
                  swoole结合php实现多任务异步处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-09-21T18:18:42+08:00" content="2017-09-21">
              2017-09-21
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><blockquote class="blockquote-center"><br>走出来的是因为从来没进去过, 进去了的, 我从没见过走出来的<br></blockquote><br>大部分时候我们项目的业务逻辑是同步阻塞运行的，但是有些时候会遇到一些耗时较大的操作，比如向十万个用户群发通知邮件，我们的程序不可能等待十万次循环后再执行其他操作，这种时候我们会采用异步操作，由 worker 进程向 task 进程发送任务，task 进程处理完全部任务之后通过onFinish回调函数通知 worker 进程。</p>
<h3 id="创建命令行类"><a href="#创建命令行类" class="headerlink" title="创建命令行类"></a>创建命令行类</h3><p>创建application/console/AsyncTask.php文件<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Console</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">console</span>\<span class="title">Command</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">console</span>\<span class="title">Input</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">console</span>\<span class="title">Output</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AsyncTask</span> <span class="keyword">extends</span> <span class="title">Command</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">protected</span> $server;</div><div class="line">    </div><div class="line">    <span class="comment">// 设置命令行名称,以及命令行描述</span></div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">configure</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;setName(<span class="string">'task:start'</span>)-&gt;setDescription(<span class="string">'Start TCP(Timer) Server!'</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span><span class="params">(Input $input, Output $output)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;server = <span class="keyword">new</span> \swoole_server(<span class="string">"0.0.0.0"</span>, <span class="number">9501</span>);</div><div class="line">        <span class="keyword">$this</span>-&gt;server-&gt;set([</div><div class="line">            <span class="string">'worker_num'</span>      =&gt; <span class="number">4</span>,</div><div class="line">            <span class="string">'daemonize'</span>       =&gt; <span class="keyword">false</span>,</div><div class="line">            <span class="string">'task_worker_num'</span> =&gt; <span class="number">4</span>  <span class="comment"># task 进程数</span></div><div class="line">        ]);</div><div class="line">        <span class="keyword">$this</span>-&gt;server-&gt;on(<span class="string">'Start'</span>, [<span class="keyword">$this</span>, <span class="string">'onStart'</span>]);</div><div class="line">        <span class="keyword">$this</span>-&gt;server-&gt;on(<span class="string">'Connect'</span>, [<span class="keyword">$this</span>, <span class="string">'onConnect'</span>]);</div><div class="line">        <span class="keyword">$this</span>-&gt;server-&gt;on(<span class="string">'Receive'</span>, [<span class="keyword">$this</span>, <span class="string">'onReceive'</span>]);</div><div class="line">        <span class="keyword">$this</span>-&gt;server-&gt;on(<span class="string">'Task'</span>, [<span class="keyword">$this</span>, <span class="string">'onTask'</span>]);</div><div class="line">        <span class="keyword">$this</span>-&gt;server-&gt;on(<span class="string">'Finish'</span>, [<span class="keyword">$this</span>, <span class="string">'onFinish'</span>]);</div><div class="line">        <span class="keyword">$this</span>-&gt;server-&gt;on(<span class="string">'Close'</span>, [<span class="keyword">$this</span>, <span class="string">'onClose'</span>]);</div><div class="line">        <span class="keyword">$this</span>-&gt;server-&gt;start();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 主进程启动时回调函数</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onStart</span><span class="params">(\swoole_server $server)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"开始\n"</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 建立连接时回调函数</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onConnect</span><span class="params">(\swoole_server $server, $fd, $from_id)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"连接上了\n"</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onReceive</span><span class="params">(\swoole_server $server, $fd, $from_id, $data)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="comment">//echo "message: &#123;$data&#125; form Client: &#123;$fd&#125; \n";</span></div><div class="line">        <span class="comment">// 投递异步任务</span></div><div class="line">        $task_id = $server-&gt;task($data);</div><div class="line">       <span class="comment">// echo "Dispath AsyncTask: id=&#123;$task_id&#125;\n";</span></div><div class="line">        <span class="comment">// 将受到的客户端消息再返回给客户端</span></div><div class="line">        $server-&gt;send($fd, <span class="string">"Message form Server: &#123;$data&#125;， task_id: &#123;$task_id&#125;"</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">// 异步任务处理函数</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onTask</span><span class="params">(\swoole_server $server, $task_id, $from_id, $data)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"&#123;$task_id&#125;, 任务处理 \n"</span>;</div><div class="line">        $server-&gt;finish(<span class="string">"$data -&gt; OK"</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onFinish</span><span class="params">(\swoole_server $server, $task_id, $data)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"结束"</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// 关闭连时回调函数</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onClose</span><span class="params">(\swoole_server $server, $fd, $from_id)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"结束\n"</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><p>文件所在 application/command.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"> </div><div class="line"><span class="keyword">return</span> [</div><div class="line">    <span class="string">'app\console\AsyncTask'</span>,</div><div class="line">];</div></pre></td></tr></table></figure></p>
<h3 id="启动任务"><a href="#启动任务" class="headerlink" title="启动任务"></a>启动任务</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">php think task:start</div></pre></td></tr></table></figure>
<h3 id="使用-telnet-进行测试"><a href="#使用-telnet-进行测试" class="headerlink" title="使用 telnet 进行测试"></a>使用 telnet 进行测试</h3><p>建议使用 xshell<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">telnet <span class="number">60.205</span><span class="number">.200</span><span class="number">.40</span> <span class="number">9501</span></div></pre></td></tr></table></figure></p>
<p>连接上服务器后，输入hello回车，发送消息给 TCP 服务器，将受到一下回执</p>
<blockquote>
<p><a href="http://www.iswoole.com/article/2066" target="_blank" rel="external">http://www.iswoole.com/article/2066</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/21/swoole结合thinkphp5实现毫秒级定时器/" itemprop="url">
                  swoole结合thinkphp5实现毫秒级定时器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-09-21T12:46:20+08:00" content="2017-09-21">
              2017-09-21
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><blockquote class="blockquote-center"><br>我有一把折断的剑，一条荆棘的路，一个看不清的未来和一场回不去的梦。<br></blockquote></p>
<h3 id="创建命令行类"><a href="#创建命令行类" class="headerlink" title="创建命令行类"></a>创建命令行类</h3><p>创建application/console/Timer.php文件<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"> </div><div class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">Console</span>;</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">console</span>\<span class="title">Command</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">console</span>\<span class="title">Input</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">console</span>\<span class="title">Output</span>;</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Timer</span> <span class="keyword">extends</span> <span class="title">Command</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">protected</span> $server;</div><div class="line">    <span class="comment">// 命令行配置函数</span></div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">configure</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="comment">// setName 设置命令行名称</span></div><div class="line">        <span class="comment">// setDescription 设置命令行描述</span></div><div class="line">        <span class="keyword">$this</span>-&gt;setName(<span class="string">'timer:start'</span>)-&gt;setDescription(<span class="string">'Start TCP(Timer) Server!'</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 设置命令返回信息</span></div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span><span class="params">(Input $input, Output $output)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;server = <span class="keyword">new</span> \swoole_server(<span class="string">'0.0.0.0'</span>, <span class="number">9501</span>);</div><div class="line">        <span class="keyword">$this</span>-&gt;server-&gt;set([</div><div class="line">            <span class="string">'worker_num'</span> =&gt; <span class="number">4</span>,</div><div class="line">            <span class="string">'daemonize'</span>  =&gt; <span class="keyword">false</span>,</div><div class="line">        ]);</div><div class="line">        <span class="keyword">$this</span>-&gt;server-&gt;on(<span class="string">'Start'</span>, [<span class="keyword">$this</span>, <span class="string">'onStart'</span>]);</div><div class="line">        <span class="keyword">$this</span>-&gt;server-&gt;on(<span class="string">'WorkerStart'</span>, [<span class="keyword">$this</span>, <span class="string">'onWorkerStart'</span>]);</div><div class="line">        <span class="keyword">$this</span>-&gt;server-&gt;on(<span class="string">'Connect'</span>, [<span class="keyword">$this</span>, <span class="string">'onConnect'</span>]);</div><div class="line">        <span class="keyword">$this</span>-&gt;server-&gt;on(<span class="string">'Receive'</span>, [<span class="keyword">$this</span>, <span class="string">'onReceive'</span>]);</div><div class="line">        <span class="keyword">$this</span>-&gt;server-&gt;on(<span class="string">'Close'</span>, [<span class="keyword">$this</span>, <span class="string">'onClose'</span>]);</div><div class="line">        <span class="keyword">$this</span>-&gt;server-&gt;start();</div><div class="line">        <span class="comment">// $output-&gt;writeln("TCP: Start.\n");</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 主进程启动时回调函数</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onStart</span><span class="params">(\swoole_server $server)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"Start"</span> . PHP_EOL;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// Worker 进程启动时回调函数</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onWorkerStart</span><span class="params">(\swoole_server $server, $worker_id)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="comment">// 仅在第一个 Worker 进程启动时启动 Timer 定时器</span></div><div class="line">        <span class="keyword">if</span> ($worker_id == <span class="number">0</span>) &#123;</div><div class="line">            <span class="comment">// 启动 Timer，每 1000 毫秒回调一次 onTick 函数，</span></div><div class="line">            swoole_timer_tick(<span class="number">1000</span>, [<span class="keyword">$this</span>, <span class="string">'onTick'</span>]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 定时任务函数</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onTick</span><span class="params">($timer_id, $params = null)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">'Hello'</span> . PHP_EOL;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 建立连接时回调函数</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onConnect</span><span class="params">(\swoole_server $server, $fd, $from_id)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"Connect"</span> . PHP_EOL;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 收到信息时回调函数</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onReceive</span><span class="params">(\swoole_server $server, $fd, $from_id, $data)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"message: &#123;$data&#125; form Client: &#123;$fd&#125;"</span> . PHP_EOL;</div><div class="line">        <span class="comment">// 将受到的客户端消息再返回给客户端</span></div><div class="line">        $server-&gt;send($fd, <span class="string">"Message form Server: "</span>.$data);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 关闭连时回调函数</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onClose</span><span class="params">(\swoole_server $server, $fd, $from_id)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"Close"</span> . PHP_EOL;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="注册命令"><a href="#注册命令" class="headerlink" title="注册命令"></a>注册命令</h3><p>文件所在 application/command.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"> </div><div class="line"><span class="keyword">return</span> [</div><div class="line">    <span class="string">'app\console\Timer'</span>,</div><div class="line">];</div></pre></td></tr></table></figure></p>
<p>接下来就可以通过命令行来启动毫秒定时器<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">php think timer:start</div></pre></td></tr></table></figure></p>
<h3 id="查看结果"><a href="#查看结果" class="headerlink" title="查看结果"></a>查看结果</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@iZ2ze20vl8jnphmrpet8txZ tp5]<span class="comment"># php think timer:start</span></div><div class="line">Start</div><div class="line">Hello</div><div class="line">Hello</div><div class="line">Hello</div><div class="line">Hello</div><div class="line">Hello</div><div class="line">Hello</div><div class="line">Hello</div><div class="line">Hello</div><div class="line">Hello</div><div class="line">Hello</div><div class="line">Hello</div><div class="line">Hello</div><div class="line">Hello</div><div class="line">Hello</div></pre></td></tr></table></figure>
<blockquote>
<p><a href="http://www.iswoole.com/article/2067" target="_blank" rel="external">http://www.iswoole.com/article/2067</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="lnmput@gmail.com" />
          <p class="site-author-name" itemprop="name">lnmput@gmail.com</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">220</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">101</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/lnmput" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.laruence.com/" title="风雪之隅" target="_blank">风雪之隅</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://tech.youzan.com/" title="有赞技术团队" target="_blank">有赞技术团队</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://tech.meituan.com/archives" title="美团点评技术团队" target="_blank">美团点评技术团队</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://macshuo.com/" title="點燈坊" target="_blank">點燈坊</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.turn.tw/" title="轉個彎日誌" target="_blank">轉個彎日誌</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lnmput@gmail.com</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  



  
  
  

  

  

</body>
</html>
